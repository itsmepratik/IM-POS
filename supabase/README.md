# Supabase Directory Structure

This directory contains all Supabase-related files for the POS system project, organized following best practices for maintainability and scalability.

## ğŸ“ Directory Structure

```
supabase/
â”œâ”€â”€ schemas/           # Declarative database schema definitions
â”œâ”€â”€ migrations/        # Database migration files
â”œâ”€â”€ functions/         # PostgreSQL functions and stored procedures
â”œâ”€â”€ policies/          # Row-Level Security (RLS) policies
â”œâ”€â”€ triggers/          # Database triggers
â”œâ”€â”€ seed/              # Initial data and test data
â”œâ”€â”€ types/             # TypeScript type definitions
â”œâ”€â”€ edge-functions/    # Supabase Edge Functions
â”œâ”€â”€ client.ts          # Browser client configuration
â”œâ”€â”€ server.ts          # Server client configuration
â”œâ”€â”€ admin.ts           # Admin client configuration
â”œâ”€â”€ database.ts        # Database type definitions
â”œâ”€â”€ index.ts           # Central export file
â”œâ”€â”€ config.toml        # Supabase configuration
â””â”€â”€ README.md          # This file
```

## ğŸ“‹ Folder Descriptions

### `schemas/`

Contains SQL files that define the desired state of your database schema. Each file represents a specific part of the schema, such as tables or views. Files are named with numerical prefixes to ensure correct application order.

**Example files:**

- `01_users.sql` - User-related tables and views
- `02_roles.sql` - Role and permission tables
- `03_permissions.sql` - Permission definitions

### `migrations/`

Holds SQL migration files that capture changes to the database schema over time. These files are typically generated by comparing the current database state with your declarative schema files.

**Naming convention:** `YYYYMMDDHHMMSS_description.sql`

### `functions/`

Includes SQL files for user-defined functions that encapsulate reusable logic within your database.

**Example functions:**

- `handle_user_signup.sql` - User registration logic
- `calculate_order_total.sql` - Order calculation logic

### `policies/`

Contains SQL files for Row-Level Security (RLS) policies, which control access to data at the row level.

**Example policies:**

- `users_rls.sql` - User data access policies
- `orders_rls.sql` - Order data access policies

### `triggers/`

Stores SQL files for database triggers that automatically execute specified functions in response to certain events.

**Example triggers:**

- `update_timestamp.sql` - Auto-update timestamps
- `notify_admin.sql` - Admin notifications

### `seed/`

Includes SQL files with initial data to populate your database, useful for setting up default values or testing data.

**Example files:**

- `initial_data.sql` - Default data for development
- `test_data.sql` - Test data for development

### `types/`

Contains TypeScript type definitions generated from your database schema.

### `edge-functions/`

Supabase Edge Functions for serverless functions that run at the edge.

## ğŸš€ Getting Started

1. **Local Development:**

   ```bash
   supabase start
   ```

2. **Generate Types:**

   ```bash
   supabase gen types typescript --local > types/database.ts
   ```

3. **Run Migrations:**

   ```bash
   supabase db reset
   ```

4. **Deploy to Production:**
   ```bash
   supabase db push
   ```

## ğŸ“ Best Practices

### Declarative Schemas

- Define your database schema in SQL files within the `schemas/` directory
- Maintain a single source of truth for your database structure
- Use numerical prefixes for proper ordering

### Version Control

- Store all schema and migration files in version control
- Track changes and enable rollbacks to previous states
- Use descriptive commit messages for database changes

### Environment Management

- Implement multiple environments (local, staging, production)
- Test changes thoroughly before deploying to production
- Use environment-specific configuration files

### Security

- Implement Row-Level Security (RLS) policies
- Use proper authentication and authorization
- Regularly audit database access patterns

## ğŸ”§ Configuration

The `config.toml` file contains all Supabase configuration settings. Key sections include:

- **API Configuration:** Ports, schemas, and row limits
- **Database Settings:** Ports, version, and connection pooling
- **Authentication:** JWT settings, email/SMS configuration
- **Storage:** File size limits and policies
- **Edge Functions:** Request policies and settings

## ğŸ“š Resources

- [Supabase Documentation](https://supabase.com/docs)
- [Database Schema Management](https://supabase.com/docs/guides/database/schema-management)
- [Row-Level Security](https://supabase.com/docs/guides/auth/row-level-security)
- [Edge Functions](https://supabase.com/docs/guides/functions)

## ğŸ¤ Contributing

When making database changes:

1. Update schema files in `schemas/`
2. Generate migrations if needed
3. Test changes locally
4. Update type definitions
5. Document any breaking changes

## ğŸ“ Support

For questions or issues related to the database setup, please refer to the main project documentation or contact the development team.
